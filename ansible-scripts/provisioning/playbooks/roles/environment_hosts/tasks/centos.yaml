---
- name: centos - install requirements
  yum:
    name: ['net-tools', 'wget', 'bind-utils']
    state: latest
    update_cache: true


- name: centos - Remove immutable.example
  ignore_errors: yes
  become: yes
  file:
    path: /etc/resolv.conf
    attributes: '-i'

- name: centos - delete file
  become: yes
  ignore_errors: yes
  file:
    state: absent
    path: /etc/resolv.conf

- name: centos - create file /etc/resolv.conf
  become: yes
  ignore_errors: yes
  file:
    path: "/etc/resolv.conf"
    state: touch

- name: centos - recreate resolv.conf.
  become: yes
  lineinfile:
    path: "/etc/resolv.conf"
    line: "{{ item }}"
  with_items:
    - '# Generated by Ansible provisioning/environment_hosts'
    - 'search {{ provisioning.domain }}'
    - 'nameserver {{ provisioning.nameserver1 }}'
    - 'nameserver {{ provisioning.nameserver2 }}'

- name: centos - Change immutable.
  become: yes
  file:
    path: /etc/resolv.conf
    attributes: '+i'
